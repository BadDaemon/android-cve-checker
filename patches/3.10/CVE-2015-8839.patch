From 407faa5f94271eb523f62a9ebb169ea7420ff07f Mon Sep 17 00:00:00 2001
From: Nick Desaulniers <ndesaulniers@google.com>
Date: Mon, 18 Jul 2016 12:45:17 -0700
Subject: [PATCH] fs: ext4: disable support for fallocate FALLOC_FL_PUNCH_HOLE

Bug: 28760453
Change-Id: I019c2de559db9e4b95860ab852211b456d78c4ca
Signed-off-by: Nick Desaulniers <ndesaulniers@google.com>
---

diff --git a/fs/ext4/inode.c b/fs/ext4/inode.c
index aeebb0c..0cb1167 100644
--- a/fs/ext4/inode.c
+++ b/fs/ext4/inode.c
@@ -3574,6 +3574,7 @@
 
 int ext4_punch_hole(struct file *file, loff_t offset, loff_t length)
 {
+#if 0
 	struct inode *inode = file_inode(file);
 	struct super_block *sb = inode->i_sb;
 	ext4_lblk_t first_block, stop_block;
@@ -3759,6 +3760,12 @@
 out_mutex:
 	mutex_unlock(&inode->i_mutex);
 	return ret;
+#else
+	/*
+	 * Disabled as per b/28760453
+	 */
+	return -EOPNOTSUPP;
+#endif
 }
 
 /*
