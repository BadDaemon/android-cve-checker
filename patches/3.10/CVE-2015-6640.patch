From 0f7b24039ad88bd63205717e239c2ab2c59f60ae Mon Sep 17 00:00:00 2001
From: Colin Cross <ccross@android.com>
Date: Tue, 05 Aug 2014 12:05:17 -0700
Subject: [PATCH] mm: fix prctl_set_vma_anon_name

prctl_set_vma_anon_name could attempt to set the name across
two vmas at the same time due to a typo, which might corrupt
the vma list.  Fix it to use tmp instead of end to limit
the name setting to a single vma at a time.

Change-Id: Ie32d8ddb0fd547efbeedd6528acdab5ca5b308b4
Reported-by: Jed Davis <jld@mozilla.com>
Signed-off-by: Colin Cross <ccross@android.com>
---

diff --git a/kernel/sys.c b/kernel/sys.c
index 1b881a1..d25bcf6 100644
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@ -2195,7 +2195,7 @@
 			tmp = end;
 
 		/* Here vma->vm_start <= start < tmp <= (end|vma->vm_end). */
-		error = prctl_update_vma_anon_name(vma, &prev, start, end,
+		error = prctl_update_vma_anon_name(vma, &prev, start, tmp,
 				(const char __user *)arg);
 		if (error)
 			return error;
