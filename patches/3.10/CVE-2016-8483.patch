From d7facbb0d7baad5b96286b9b832cb15b39e7bbff Mon Sep 17 00:00:00 2001
From: Archana Sathyakumar <asathyak@codeaurora.org>
Date: Mon, 03 Nov 2014 14:24:37 -0700
Subject: [PATCH] msm-core: Fix potential NULL pointer issue

If argp is NULL, accessing argp without a NULL pointer check
results in kernel crash. Add a check before accessing the variable.

Change-Id: Ic06162911a998a9daffb36eede094ede6cecbe40
Signed-off-by: Archana Sathyakumar <asathyak@codeaurora.org>
---

diff --git a/drivers/power/qcom/msm-core.c b/drivers/power/qcom/msm-core.c
index 39115a1..204674b 100644
--- a/drivers/power/qcom/msm-core.c
+++ b/drivers/power/qcom/msm-core.c
@@ -399,13 +399,16 @@
 	struct cpu_activity_info *node = NULL;
 	struct sched_params __user *argp = (struct sched_params __user *)arg;
 	int i, cpu = num_possible_cpus();
-	int mpidr = (argp->cluster << (MAX_CORES_PER_CLUSTER *
-			MAX_NUM_OF_CLUSTERS));
-	int cpumask = argp->cpumask;
+	int mpidr;
+	int cpumask;
 
 	if (!argp)
 		return -EINVAL;
 
+	mpidr = (argp->cluster << (MAX_CORES_PER_CLUSTER *
+			MAX_NUM_OF_CLUSTERS));
+	cpumask = argp->cpumask;
+
 	switch (cmd) {
 	case EA_LEAKAGE:
 		ret = update_userspace_power(argp);
