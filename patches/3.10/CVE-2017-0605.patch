From 79d5878d81deb1e52503ac53291808842ed2ca1d Mon Sep 17 00:00:00 2001
From: Amey Telawane <ameyt@codeaurora.org>
Date: Mon, 01 Aug 2016 16:50:43 +0530
Subject: [PATCH] trace: resolve stack corruption due to string copy

Strcpy has no limit on string being copied which causes
stack corruption leading to kernel panic. Use strlcpy to
resolve the issue by providing length of string to be copied.

CRs-fixed: 1048480
Change-Id: Ib290b25f7e0ff96927b8530e5c078869441d409f
Signed-off-by: Amey Telawane <ameyt@codeaurora.org>
---

diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 92e7c9c..4abe90e 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -1472,7 +1472,7 @@
 	arch_spin_lock(&trace_cmdline_lock);
 	map = map_pid_to_cmdline[pid];
 	if (map != NO_CMDLINE_MAP)
-		strcpy(comm, saved_cmdlines[map]);
+		strlcpy(comm, saved_cmdlines[map], TASK_COMM_LEN-1);
 	else
 		strcpy(comm, "<...>");
 
