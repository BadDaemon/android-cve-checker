From 8130fa7ef3228a073c0587efb1e1d4a21599f264 Mon Sep 17 00:00:00 2001
From: VijayaKumar T M <vtmuni@codeaurora.org>
Date: Mon, 07 Nov 2016 15:19:06 +0530
Subject: [PATCH] msm: sensor: Adding mutex for actuator power down operations

Protecting operations performed during actuator power down
from race condition by adding mutex.

CRs-Fixed: 1071891
Change-Id: I7d6b2e8878788615c02678a4a28d31dca0ed6bca
Signed-off-by: Sureshnaidu Laveti <lsuresh@codeaurora.org>
Signed-off-by: VijayaKumar T M <vtmuni@codeaurora.org>
---

diff --git a/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c b/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c
index 6f9ba13..8c5fc53 100644
--- a/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c
+++ b/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c
@@ -1502,11 +1502,13 @@
 			pr_err("a_ctrl->i2c_client.i2c_func_tbl NULL\n");
 			return -EINVAL;
 		} else {
+			mutex_lock(a_ctrl->actuator_mutex);
 			rc = msm_actuator_power_down(a_ctrl);
 			if (rc < 0) {
 				pr_err("%s:%d Actuator Power down failed\n",
 					__func__, __LINE__);
 			}
+			mutex_unlock(a_ctrl->actuator_mutex);
 			return msm_actuator_close(sd, NULL);
 		}
 	default:
